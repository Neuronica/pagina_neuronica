 <ng-container *ngIf="!cargandoDatos && !errorAlCargar">  
    <div class="fondo">
        <div class="spacer2"></div>
            <div class="contenedorColumnas">
                <div class="spacer2"></div>
                <div class="bordeAzul">
                    <div class="spacer2"></div>
                    <div class="unaColumna">
                        <div class="filas">
                            <div class="detalle-producto">
                                <div class="tarjeta-descripcion">
                                    <div class="carrusel-contenedor" data-aos="fade-right" data-aos-duration="2000">
                                        <div class="carrusel-imagen">
                                            <button *ngIf="informationProduct[0].type != 'material'" class="carrusel-boton-nav" (click)="anteriorImagen()" [disabled]="imagesList.length <= 1">
                                                &#10094;
                                            </button>
                                            <img *ngIf="imagenActual" [src]="imagenActual.url" alt="Imagen del producto {{ idProducto }}">
                                            <button *ngIf="informationProduct[0].type != 'material'" class="carrusel-boton-nav" (click)="siguienteImagen()" [disabled]="imagesList.length <= 1">
                                                &#10095;
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="tarjeta-descripcion">
                                    <h1 style="text-align: center;" data-aos="fade-left" data-aos-duration="2000">{{informationProduct[0].name}}</h1>
                                    <div class="precios">
                                        <h3 *ngIf="informationProduct[0].offer != null" style=" color: #D37600; font-weight: bold; text-decoration: line-through; opacity: 0.5; text-align: center;" data-aos="fade-right" data-aos-duration="2000">{{informationProduct[0].price| currency:'USD':'symbol':'1.0-0'}}</h3>
                                        <h3 *ngIf="informationProduct[0].offer != null" style=" color: #D37600; font-weight: bold; text-align: center;" data-aos="fade-left" data-aos-duration="2000">{{ informationProduct[0].offer | currency:'USD':'symbol':'1.0-0'}} IVA incluido</h3>
                                        <h3 *ngIf="informationProduct[0].offer === null" style=" color: #D37600; font-weight: bold; text-align: center;" data-aos="fade-right" data-aos-duration="2000">{{ informationProduct[0].price | currency:'USD':'symbol':'1.0-0'}} IVA incluido</h3>
                                    </div>
                                    
                                    <div class="detalle-grid">
                                        <div *ngFor="let a of attribute; let i = index" class="detalle-fila">
                                            <span class="col-attr" style="text-align: center;" data-aos="fade-left" data-aos-duration="2000"> {{a.attribute}} </span>
                                            <span class="col-value" style="text-align: center;" data-aos="fade-right" data-aos-duration="2000"> {{a.value}} </span>
                                            <span class="col-unit" style="text-align: center;" data-aos="fade-left" data-aos-duration="2000"> {{a.unit}}</span>
                                        </div>
                                        <div class="detalle-fila">
                                            <h3 style="margin: 0; color: #D37600;" data-aos="fade-right" data-aos-duration="2000">Disponibles</h3>
                                            <span class="stock-badge" data-aos="fade-left" data-aos-duration="2000">
                                            {{variantStock | number: '1.0-0'}}
                                            </span>
                                        </div>
                                    </div>
                                    <div *ngIf="informationProduct[0].type === 'material'" class="color-container">
                                        <span class="col-attr">Colores</span>
                                        <div class="bolitas">
                                            <div *ngFor="let p of informationProduct; let i = index">
                                                <button  class="color-card" style="background-color: white;" (click)="changeVariant(i, p.json['color'])">
                                                    <div 
                                                    *ngIf = "i != actualImageMaterial"
                                                    class="color-bolita-test"
                                                    [style.backgroundColor]="getColorCode(p.json['color'])"></div>                                                    

                                                    <div 
                                                    *ngIf = "i === actualImageMaterial"
                                                    class="color-bolita-test"
                                                    style="border-color: #005f75;"
                                                    [style.backgroundColor]="getColorCode(p.json['color'])"></div>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="botones-container" data-aos="fade-right" data-aos-duration="2000">
                                    <a href="https://wa.me/573027218775?text=Hola, quiero comprar una impresora 3D"
                                    class="whatsapp-button"
                                    target="_blank">
                                    <span class="button-text">
                                        Comprar en
                                        <img src="./assets/Imagenes/WhatsApp.webp"
                                            alt="WhatsApp"
                                            width="40"
                                            style="margin-left:8px;"/>
                                    </span>
                                    </a>
                                    
                                    <a href="https://articulo.mercadolibre.com.co/MCO-{{url_mercado_libre}}"
                                    class="mercadoLibre-button"
                                    target="_blank"
                                    rel="noopener noreferrer">
                                    <span class="button-text">
                                        Comprar en
                                        <img src="./assets/Imagenes/mercadolibre.webp"
                                            alt="Mercado Libre"
                                            width="40"
                                            style="margin-left:8px;"/>
                                    </span>
                                    </a>
                                </div>

                            </div>
                        </div>
                        <div class="spacer2"></div>                  
                    </div>                    
                </div>
            <div class="spacer2"></div>
        </div>
        <div class="spacer2"></div>

        <div class="contenedorColumnas">
            <div class="spacer2"></div>
            <div class="bordeAzul">
                <div class="filas">
                    <div class="unaColumna">
                        <div class="spacer2"></div>
                        <h2 style="text-align: center;" data-aos="fade-left" data-aos-duration="2000">Descripción</h2>
                        <div class="cuadrado" style="margin-right: 5%; margin-left: 5%;" data-aos="fade-right" data-aos-duration="2000"></div>
                        <div class="spacer2"></div>
                        <p style="margin-left: 5%; margin-right: 5%; text-align:justify" data-aos="fade-left" data-aos-duration="2000">
                            {{informationProduct[0].description}}
                        </p>
                        <div class="spacer2"></div>
                    </div>
                </div>
            </div>
            <div class="spacer2"></div>
        </div>
        <div class="spacer2"></div>
        <div class="contenedorColumnas">
            <div class="spacer2"></div>
            <div class="bordeAzul">
                <div class="filas">
                    <div class="unaColumna">
                        <div class="video-responsive-contenedor" data-aos="fade-right" data-aos-duration="2000"> 
                            <iframe
                            *ngIf="videoUrl"
                            [src]="videoUrl"
                            frameborder="0"
                            loading="lazy"
                            referrerpolicy="strict-origin-when-cross-origin"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            allowfullscreen>
                            </iframe>
                        </div>
                    </div>
                </div>
            </div>
            <div class="spacer2"></div>
        </div>
       <div class="spacer2"></div>
       <div class="contenedorColumnas">
            <div class="spacer2"></div>
            <div class="bordeAzul">
                <div class="filas">
                    <div class="unaColumna">
                        <div class="spacer2"></div>
                        <h2 style="text-align: center;" data-aos="fade-left" data-aos-duration="2000">Relacionados</h2>
                        <div class="cuadrado" style="margin-right: 5%; margin-left: 5%;" data-aos="fade-right" data-aos-duration="2000"></div>
                        <div class="spacer2"></div>
                        <div class="carrusel-productos-relacionados" data-aos="fade-left" data-aos-duration="2000">
                            <button class="carrusel-boton-nav" (click)="anteriorRelacionado()">&#10094;</button>             
                            <div class="carrusel-items-contenedor" *ngIf="relatedProducts?.length as total">
                                <!-- Caso: más de 3, carrusel de a 3 -->
                                <div *ngIf="total > 3; else fewTpl"
                                    class="carrusel-items-wrapper"
                                    [style.transform]="'translateX(-' + indiceRelacionadoActual * (100 / 3) + '%)'">
                                    <div *ngFor="let relacionado of relatedProducts; trackBy: trackBySlug"
                                        class="lista-tarjeta-productos"
                                        style="margin: 0 2%;"
                                        [style.flex]="'0 0 calc(100% / 3)'"
                                        [routerLink]="['/producto', relacionado.slug]">
                                        <div class="contenedor-imagen-carrusel">
                                            <img [src]="getProductoImageUrl(relacionado.slug)" [alt]="relacionado.product">
                                            <div *ngIf="relacionado.offer != null" class="banner-oferta">¡Oferta!</div>
                                        </div>
                                        <h3>{{ relacionado.product }}</h3>
                                        <p *ngIf="relacionado.offer === null">Precio: {{ relacionado.price | currency:'USD':'symbol':'1.0-0' }}</p>
                                        <p *ngIf="relacionado.offer != null">Precio: {{ relacionado.offer | currency:'USD':'symbol':'1.0-0' }}</p>
                                    </div>
                                </div>

                                <!-- Caso: 1 a 3, mostrar todos sin corte -->
                                <ng-template #fewTpl>
                                    <div class="carrusel-items-wrapper"
                                    [style.transform]="'translateX(-' + indiceRelacionadoActual * (100 / 3) + '%)'">
                                    <div *ngFor="let relacionado of relatedProducts; trackBy: trackBySlug"
                                        class="lista-tarjeta-productos"
                                        style="margin: 0 2%;"
                                        [style.flex]="'0 0 calc(100% / 3)'"
                                        [routerLink]="['/producto', relacionado.slug]">
                                        <div class="contenedor-imagen-carrusel">
                                        <img [src]="getProductoImageUrl(relacionado.slug)" [alt]="relacionado.product">
                                        <div *ngIf="relacionado.offer != null" class="banner-oferta">¡Oferta!</div>
                                        </div>
                                        <h3>{{ relacionado.product }}</h3>
                                        <p *ngIf="relacionado.offer === null">Precio: {{ relacionado.price | currency:'USD':'symbol':'1.0-0' }}</p>
                                        <p *ngIf="relacionado.offer != null">Precio: {{ relacionado.offer | currency:'USD':'symbol':'1.0-0' }}</p>
                                    </div>
                                    </div>
                                </ng-template>
                            </div>
   
                            <button class="carrusel-boton-nav" (click)="siguienteRelacionado()">&#10095;</button>
                        </div>
                        <div class="spacer2"></div>
                    </div>
                </div>
            </div>
            <div class="spacer2"></div>
        </div>
        <div class="spacer2"></div>
        <app-footer-container></app-footer-container>
        <div class="spacer2"></div>
    </div>

    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-11327971754"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'AW-11327971754');
    </script>
</ng-container>

<div *ngIf="cargandoDatos" class="loading-overlay">
  <app-loading></app-loading>
</div>

<div *ngIf="errorAlCargar" class="error-state">
  <app-error
    [titulo]="'Error de conexión'" 
    [mensaje]="'No se pudo obtener la información del servidor.'"></app-error>
</div>